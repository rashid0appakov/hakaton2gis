# Хокотон

Проект отображает «тепловые» кластеры квартир на карте Москвы, позволяет выбрать район, провалиться в кластер, посмотреть список квартир и детальную карточку с оценкой доступности инфраструктуры для семьи. Данные подгружаются из api сервисов превращаясь в JSON нужного формата и с расчетами и визуализируются на карте 2ГИС (MapGL SDK).

## Содержание
- Стек и ключевые технологии
- Структура проекта
- Запуск и переменные окружения
- Поток работы в интерфейсе
- Данные и их источники
- Логика кластеров и фильтров
- Интеграция с картами 2ГИС
- Развитие и TODO

## Стек и ключевые технологии
- Vue 3 (Composition API, `<script setup>`)
- 2ГИС MapGL JavaScript SDK (интерактивная карта, полигоны районов, полилинии, HTML-маркеры)
- Чистый CSS без UI-фреймворков
- Локальные JSON-данные в `public/`

## Запуск и переменные окружения
1) Установка зависимостей:
```bash
npm ci
```
.env.local оставил как есть с api ключем внутри
```
2) Старт дев-сервера:
```bash
npm run dev
```
Откройте адрес `http://localhost:5173`.

## Поток работы в интерфейсе
1) Пользователь проходит квиз (`QuizModal.vue`):
   - Указывает детей (0–7, 7–14, 14–17), выбирает приоритеты.
   - Вводит бюджет «до» и выбирает один или несколько вариантов количества комнат (1–8).
2) По нажатию «Посмотреть» в `App.vue` запускается режим районов на карте (`MapView.vue`):
   - Загружается `mo.geojson` (районы), отрисовываются полигоны.
   - Загружается `appartments.json`, применяются фильтры бюджета и комнат.
   - По районам строится «тепловая» карта кластеров квартир (облака).
3) Клик по району — карта зумится к району, кластеры становятся кликабельны.
4) Клик по кластеру — открывается список квартир кластера в нижней панели (`BottomSheet.vue`).
5) Клик по квартире — открывается страница квартиры: цена, адрес, «Для вашей семьи» (оценка 3 критериев), «Главное в этой квартире», кнопка «Забронировать» (ссылка).
6) Стрелка назад в шапке района работает пошагово: квартира → список кластера → кластеры района → выбор района.

## Данные и их источники
- Квартиры: выгружены с ЦИАН (cian.ru). Формирование JSON делали на Python.
- Объекты инфраструктуры (детские сады, детские поликлиники): данные из 2ГИС.
- Парки: открытые данные с `data.mos.ru`.
- Сформировали единый `appartments.json` и используем на фронте для фильтрации и отображения.

Пример полей квартиры (сокращенно): `id`, `url`, `price`, `area`, `rooms`, `room_type`, `address`, `latitude`, `longitude`, `nearest_objects` с `nearest_kindergartens`, `nearest_child_hospitals`, `nearest_parks` (каждый — массив объектов, где у первого элемента берем `distance` и по возможности одиночную координату).

## Логика кластеров и фильтров
- «Тепловая» карта: квартиры группируются в кластеры простым грид-алгоритмом. Для кластера строится «облако» — выпуклая оболочка с плавным «раздуванием» и сглаживанием Chaikin.
- Цвет кластера (зелёный/оранжевый/красный) определяется по медианным дистанциям до сада, поликлиники и парка в квартирах кластера: зелёный ≤ 1 км по всем, оранжевый ≤ 2 км по всем, иначе красный.
- Клик по кластеру: показываем HTML-маркеры квартир, строим линии до ближайших объектов по каждому типу, рисуем маркеры объектов.
- Фильтры: «бюджет до» и «комнаты (множественный выбор)» применяются к `appartments.json` на этапе загрузки в `MapView.vue`. Если фильтры не заданы — используется весь массив.
- В коде оставлена заготовка (TODO) для «возрастного» фильтра 0–7 лет, чтобы при необходимости отдавать весь JSON без ограничений.

## Интеграция с 2ГИС (MapGL SDK)
- Отрисовка карты, полигонов районов (`Polygon`), линий (`Polyline`), HTML-маркеров (`HtmlMarker`).
- Хит-зоны кластеров — кликабельные полигоны с полупрозрачной заливкой.
- Геометрические утилиты: проверка точки на вхождение в полигон/мультиполигон, вычисление выпуклой оболочки, сглаживание, оценка расстояния (haversine), проекция «по азимуту» при отсутствии точной координаты объекта.

## Детальная карточка квартиры (BottomSheet)
- «Для вашей семьи»: 3 критерия (детские сады, парки, поликлиника) — шкалы/цвета по расстоянию до ближайших объектов, сводный балл.
- «Главное в этой квартире»: статичный список преимуществ с эмодзи.
- Кнопка «Забронировать» открывает ссылку квартиры.

## Развитие и TODO
- Поддержать «возрастной» фильтр 0–7 лет и остальные (см. TODO в `QuizModal.vue` и `MapView.vue`).
- Фото квартир добавить.
- Сохранение избранных, шэринг на карту/квартиру.
- Серверная фильтрация/агрегации когда будет доступ к закрытому Api 2gis.